---
title: "Random Puzzles"
subtitle: "Unique random shapes with configurable complexity"
---

```{r}
#| label: setup-random
#| include: false
# Flexible path: works from project root (Quarto) or quarto/gallery/ (RStudio interactive)
setup_path <- if (file.exists("quarto/_setup.R")) "quarto/_setup.R" else "../_setup.R"
source(setup_path)
```

## Overview

Random puzzles generate unique, irregular piece shapes using a randomized approach. Unlike the regular patterns of rectangular or hexagonal puzzles, random puzzles create organic, unpredictable boundaries that make each puzzle truly one-of-a-kind.

## Piece Count Variations

::: {.panel-tabset}

## ggpuzzle

```{r}
#| label: fig-rand-piece-counts-ggpuzzle
#| fig-align: center
make_rand_pieces <- function(n) {
  ggplot() +
    geom_puzzle_random(
      aes(fill = after_stat(piece_id)),
      n_interior = n,
      seed = 42
    ) +
    scale_fill_viridis_c(option = "inferno", guide = "none") +
    coord_fixed() +
    theme_puzzle() +
    labs(title = paste0(n, " pieces"))
}

print(make_rand_pieces(10) + make_rand_pieces(20) + make_rand_pieces(40))
```

## API

```{r}
#| label: fig-rand-piece-counts-api
#| results: asis
#| echo: false

# Generate piece count previews in a grid
counts <- c(10, 20, 40)

cat('<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1em; margin: 1em 0;">')
for (n in counts) {
  result <- generate_puzzle(
    type = "random",
    grid = c(n),
    size = c(200, 200),
    seed = 42
  )
  cat(sprintf('<div style="text-align: center;"><div style="font-weight: bold; margin-bottom: 0.5em;">%d pieces</div>%s</div>',
              n, result$svg_content))
}
cat('</div>')
```

```{r}
#| label: fig-rand-piece-counts-api-code
#| eval: false
# API with varying piece counts
result <- generate_puzzle(
  type = "random",
  grid = c(20),         # Number of interior points
  size = c(200, 200),   # height, width in mm
  seed = 42
)
render_puzzle_preview(result)
```

:::

## Corner Variations

The `n_corner` parameter controls the complexity of each piece's shape:

::: {.panel-tabset}

## ggpuzzle

```{r}
#| label: fig-rand-corners-ggpuzzle
#| fig-align: center

make_rand_corners <- function(nc, label) {
  ggplot() +
    geom_puzzle_random(
      aes(fill = after_stat(piece_id)),
      n_interior = 15,
      n_corner = nc,
      seed = 42
    ) +
    scale_fill_viridis_c(option = "plasma", guide = "none") +
    coord_fixed() +
    theme_puzzle() +
    labs(title = label)
}

print(make_rand_corners(3, "3 corners") + make_rand_corners(4, "4 corners") +
make_rand_corners(6, "6 corners") + make_rand_corners(8, "8 corners"))
```

## API

```{r}
#| label: fig-rand-corners-api
#| results: asis
#| echo: false

# Generate corner variation previews in a grid
corners <- c(3, 4, 6, 8)

cat('<div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1em; margin: 1em 0;">')
for (nc in corners) {
  result <- generate_puzzle(
    type = "random",
    grid = c(15),
    size = c(200, 200),
    seed = 42,
    n_corner = nc
  )
  cat(sprintf('<div style="text-align: center;"><div style="font-weight: bold; margin-bottom: 0.5em;">%d corners</div>%s</div>',
              nc, result$svg_content))
}
cat('</div>')
```

```{r}
#| label: fig-rand-corners-api-code
#| eval: false
# API with n_corner for piece shape complexity
result <- generate_puzzle(
  type = "random",
  grid = c(15),
  size = c(200, 200),
  seed = 42,
  n_corner = 5  # 3-8, higher = more complex shapes
)
render_puzzle_preview(result)
```

:::

## Color Palettes

::: {.panel-tabset}

## ggpuzzle

```{r}
#| label: fig-rand-palettes-ggpuzzle
#| fig-align: center

make_rand_palette <- function(pal) {
  ggplot() +
    geom_puzzle_random(
      aes(fill = after_stat(piece_id)),
      n_interior = 20,
      seed = 42
    ) +
    scale_fill_viridis_c(option = pal, guide = "none") +
    coord_fixed() +
    theme_puzzle() +
    labs(title = pal)
}

print((make_rand_palette("viridis") + make_rand_palette("magma") + make_rand_palette("plasma")) /
(make_rand_palette("inferno") + make_rand_palette("cividis") + make_rand_palette("turbo")))
```

## API

```{r}
#| label: fig-rand-palettes-api
#| results: asis
#| echo: false

# Generate all palette previews and combine into a grid
palettes <- c("viridis", "magma", "plasma", "inferno", "cividis", "turbo")

cat('<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1em; margin: 1em 0;">')
for (pal in palettes) {
  result <- generate_puzzle(
    type = "random",
    grid = c(20),
    size = c(200, 200),
    seed = 42,
    fill_palette = pal
  )
  cat(sprintf('<div style="text-align: center;"><div style="font-weight: bold; margin-bottom: 0.5em;">%s</div>%s</div>',
              pal, result$svg_content))
}
cat('</div>')
```

```{r}
#| label: fig-rand-palettes-api-code
#| eval: false
# API with fill_palette for colored fills
result <- generate_puzzle(
  type = "random",
  grid = c(20),
  size = c(200, 200),
  seed = 42,
  fill_palette = "viridis"  # Options: viridis, magma, plasma, inferno, cividis, turbo
)
render_puzzle_preview(result)
```

:::

## Offset (Separation)

::: {.panel-tabset}

## ggpuzzle

```{r}
#| label: fig-rand-offset-ggpuzzle
#| fig-align: center

make_rand_offset <- function(off) {
  ggplot() +
    geom_puzzle_random(
      aes(fill = after_stat(piece_id)),
      n_interior = 18,
      offset = off, seed = 42
    ) +
    scale_fill_viridis_c(option = "cividis", guide = "none") +
    coord_fixed() +
    theme_puzzle() +
    labs(title = paste0("offset = ", off))
}

print(make_rand_offset(0) + make_rand_offset(5) + make_rand_offset(10) + make_rand_offset(20))
```

## API

```{r}
#| label: fig-rand-offset-api
#| results: asis
#| echo: false

# Generate offset previews in a grid
offsets <- c(0, 5, 10, 20)

cat('<div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1em; margin: 1em 0;">')
for (off in offsets) {
  result <- generate_puzzle(
    type = "random",
    grid = c(18),
    size = c(200, 200),
    seed = 42,
    offset = off
  )
  cat(sprintf('<div style="text-align: center;"><div style="font-weight: bold; margin-bottom: 0.5em;">offset = %d</div>%s</div>',
              off, result$svg_content))
}
cat('</div>')
```

```{r}
#| label: fig-rand-offset-api-code
#| eval: false
# API with offset for piece separation
result <- generate_puzzle(
  type = "random",
  grid = c(18),
  size = c(200, 200),
  offset = 10,  # Separation in mm
  seed = 42
)
render_puzzle_preview(result)
```

:::

## Seed Variations

Each seed creates a completely unique puzzle:

::: {.panel-tabset}

## ggpuzzle

```{r}
#| label: fig-rand-seeds-ggpuzzle
#| fig-align: center

make_rand_seed <- function(s) {
  ggplot() +
    geom_puzzle_random(
      aes(fill = after_stat(piece_id)),
      n_interior = 15,
      seed = s
    ) +
    scale_fill_viridis_c(option = "turbo", guide = "none") +
    coord_fixed() +
    theme_puzzle() +
    labs(title = paste0("seed = ", s))
}

print(make_rand_seed(1) + make_rand_seed(42) + make_rand_seed(123) + make_rand_seed(999))
```

## API

```{r}
#| label: fig-rand-seeds-api
#| results: asis
#| echo: false

# Generate seed variation previews in a grid
seeds <- c(1, 42, 123, 999)

cat('<div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1em; margin: 1em 0;">')
for (s in seeds) {
  result <- generate_puzzle(
    type = "random",
    grid = c(15),
    size = c(200, 200),
    seed = s
  )
  cat(sprintf('<div style="text-align: center;"><div style="font-weight: bold; margin-bottom: 0.5em;">seed = %d</div>%s</div>',
              s, result$svg_content))
}
cat('</div>')
```

:::

::: {.callout-tip}
## Aspect Ratios
Random puzzles handle any aspect ratio - wide, square, or tall. See the [Aspect Ratios Tutorial](../tutorials/aspect-ratios.qmd) for examples comparing all puzzle types.
:::

## Large Random Puzzle

::: {.panel-tabset}

## ggpuzzle

```{r}
#| label: fig-rand-large-ggpuzzle
#| fig-align: center
#| fig-width: 10
#| fig-height: 6

ggplot() +
  geom_puzzle_random(
    aes(fill = after_stat(piece_id)),
    n_interior = 60,
    seed = 456
  ) +
  scale_fill_viridis_c(option = "turbo", guide = "none") +
  coord_fixed() +
  theme_puzzle() +
  labs(title = "60-Piece Random Puzzle")
```

## API

```{r}
#| label: fig-rand-large-api
#| fig-align: center

result <- generate_puzzle(
  type = "random",
  grid = c(60),
  size = c(400, 300),
  seed = 456
)
render_puzzle_preview(result, max_width = "600px")
```

:::

## Parameters Reference

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `n_interior` | integer | 12 | Number of interior points (influences piece count) |
| `n_corner` | integer | 4 | Corners per piece (3-8) |
| `seed` | integer | random | Random seed for reproducibility |
| `offset` | numeric | 0 (mm) | Piece separation distance |
| `tabsize` | numeric | 10 (%) | Tab size as percentage of piece width |
| `jitter` | numeric | 2 (%) | Randomness in tab shape as percentage |
| `min_tab_size` | numeric | 0 (mm) | Minimum tab size in millimeters |
| `max_tab_size` | numeric | Inf (mm) | Maximum tab size in millimeters |
| `fusion_groups` | string | NULL | PILES notation for fusing pieces |

## Corner Complexity Guide

| n_corner | Shape | Complexity |
|----------|-------|------------|
| 3 | Triangular | Simple, angular |
| 4 | Quadrilateral | Classic, balanced |
| 5 | Pentagonal | Natural, organic |
| 6 | Hexagonal | Honeycomb-like |
| 7-8 | Complex | Highly irregular |

## When to Use Random Puzzles

Random puzzles are perfect for:

- **Maximum uniqueness**: No two puzzles alike
- **Artistic applications**: Abstract, modern designs
- **Challenge modes**: Irregular shapes are harder to assemble
- **Custom piece counts**: Exact control over difficulty

## Code Example

::: {.panel-tabset}

## API

```{r}
#| label: demo-rand-api
#| fig-align: center

result <- generate_puzzle(
  type = "random",
  grid = c(30),          # 30 pieces
  size = c(400, 300),    # height=400mm, width=300mm
  seed = 42,
  n_corner = 5,          # Pentagonal pieces
  offset = 5
)

render_puzzle_preview(result)
```

## ggpuzzle

```{r}
#| label: demo-rand-ggpuzzle
#| fig-align: center

ggplot() +
  geom_puzzle_random(
    aes(fill = after_stat(piece_id)),
    n_interior = 30,
    width = 400, height = 300,
    n_corner = 5,
    seed = 42, offset = 5
  ) +
  scale_fill_viridis_c(option = "inferno", guide = "none") +
  coord_fixed() +
  theme_puzzle()
```

:::

::: {.callout-note}
## Saving to File
The API approach returns a result object that can be saved to SVG:
```r
writeLines(result$svg_content, "random_puzzle.svg")
```
:::
