---
title: "Getting Started"
subtitle: "Install jigsawR and create your first puzzle"
---

```{r}
#| label: setup
#| include: false
# Flexible path: works from project root (Quarto) or quarto/ (RStudio interactive)
setup_path <- if (file.exists("quarto/_setup.R")) "quarto/_setup.R" else "_setup.R"
source(setup_path)
```

## Installation

### From GitHub (Recommended)

```r
# Install devtools if needed
install.packages("devtools")

# Install jigsawR
devtools::install_github("pjt222/jigsawR")
```

### Dependencies

jigsawR requires:

- R â‰¥ 4.0.0
- ggplot2, ggforce, ggfx (for ggpuzzle extension)
- viridis (for color palettes)

Optional dependencies:

- rsvg (for PNG export)
- magick (for image processing)

## Your First Puzzle

jigsawR offers two ways to create puzzles:

1. **API** (`generate_puzzle()`): Returns SVG content and piece data for manufacturing
2. **ggpuzzle** (`geom_puzzle_*()`): Integrates with ggplot2 for visualization

::: {.panel-tabset}

## API Approach

```{r}
#| label: first-puzzle-api
#| message: false
library(jigsawR)

# Generate a 4x3 puzzle
result <- generate_puzzle(

  type = "rectangular",
  grid = c(4, 3),        # 4 rows, 3 columns
  size = c(400, 300),    # 400mm x 300mm
  seed = 42              # For reproducibility
)

# Check the result
n_pieces <- length(result$pieces)
canvas_w <- result$canvas_size[1]
canvas_h <- result$canvas_size[2]
cli::cli_alert_info("Generated {n_pieces} pieces")
cli::cli_alert_info("Canvas size: {canvas_w} x {canvas_h} mm")
```

**Render the SVG:**

```{r}
#| label: first-puzzle-api-render
#| fig-align: center
#| echo: false
render_puzzle_preview(result)
```

**Save your puzzle:**

```r
# Save as SVG (for laser cutting, etc.)
writeLines(result$svg_content, "my_puzzle.svg")

# Save as PNG (requires rsvg)
rsvg::rsvg_png(charToRaw(result$svg_content), "my_puzzle.png", width = 800)
```

## ggpuzzle Approach

```{r}
#| label: first-puzzle-ggpuzzle
#| fig-align: center
#| message: false
library(ggplot2)
library(viridis)

ggplot() +
  geom_puzzle_rect(
    aes(fill = after_stat(piece_id)),
    rows = 4, cols = 3,    # Same as grid = c(4, 3)
    width = 400, height = 300,
    seed = 42
  ) +
  scale_fill_viridis_c(option = "viridis", guide = "none") +
  coord_fixed() +
  theme_puzzle() +
  labs(title = "4x3 Rectangular Puzzle")
```

**Save your puzzle:**

```r
# Save as PNG with ggsave
ggsave("my_puzzle.png", width = 8, height = 6, dpi = 300)
```

:::

::: {.callout-tip}
## Which approach should I use?

- **API**: Best for manufacturing (laser cutting, 3D printing) and when you need raw SVG output
- **ggpuzzle**: Best for visualization, data exploration, and when you want ggplot2's styling options
:::

### Parameter Mapping

The two approaches use equivalent parameters:

| API (`generate_puzzle()`) | ggpuzzle (`geom_puzzle_rect()`) |
|---------------------------|--------------------------------|
| `type = "rectangular"` | Use `geom_puzzle_rect()` |
| `grid = c(4, 3)` | `rows = 4, cols = 3` |
| `size = c(400, 300)` | `width = 400, height = 300` |
| `seed = 42` | `seed = 42` |
| `tabsize = 10` | `tabsize = 10` |
| `offset = 10` | `offset = 10` |

## Puzzle Types

### 1. Rectangular

Classic jigsaw with interlocking tabs on all sides.

```{r}
#| label: type-rectangular
#| fig-align: center
ggplot() +
  geom_puzzle_rect(
    aes(fill = after_stat(piece_id)),
    cols = 5, rows = 4,
    seed = 123
  ) +
  scale_fill_viridis_c(option = "plasma", guide = "none") +
  coord_fixed() +
  theme_puzzle() +
  labs(title = "5x4 Rectangular Puzzle")
```

### 2. Hexagonal

Honeycomb pattern with beautiful curved tabs.

```{r}
#| label: type-hexagonal
#| fig-align: center
ggplot() +
  geom_puzzle_hex(
    aes(fill = after_stat(piece_id)),
    rings = 3,
    seed = 456
  ) +
  scale_fill_viridis_c(option = "magma", guide = "none") +
  coord_fixed() +
  theme_puzzle() +
  labs(title = "3-Ring Hexagonal Puzzle")
```

### 3. Concentric

Rings of pieces radiating from a central shape.

```{r}
#| label: type-concentric
#| fig-align: center
ggplot() +
  geom_puzzle_conc(
    aes(fill = after_stat(ring)),
    rings = 3,
    center_shape = "hexagon",
    seed = 789
  ) +
  scale_fill_viridis_c(option = "cividis", guide = "none") +
  coord_fixed() +
  theme_puzzle() +
  labs(title = "3-Ring Concentric Puzzle")
```

### 4. Voronoi

Organic, natural-looking pieces based on Voronoi tessellation.

```{r}
#| label: type-voronoi
#| fig-align: center
ggplot() +
  geom_puzzle_voronoi(
    aes(fill = after_stat(piece_id)),
    n_cells = 20,
    seed = 101
  ) +
  scale_fill_viridis_c(option = "turbo", guide = "none") +
  coord_fixed() +
  theme_puzzle() +
  labs(title = "20-Cell Voronoi Puzzle")
```

### 5. Random

Unique random shapes with configurable corners.

```{r}
#| label: type-random
#| fig-align: center
ggplot() +
  geom_puzzle_random(
    aes(fill = after_stat(piece_id)),
    n_pieces = 15,
    seed = 202
  ) +
  scale_fill_viridis_c(option = "inferno", guide = "none") +
  coord_fixed() +
  theme_puzzle() +
  labs(title = "15-Piece Random Puzzle")
```

## Key Parameters

### Common Parameters

| Parameter | Description | Example |
|-----------|-------------|---------|
| `type` | Puzzle type | `"rectangular"`, `"hexagonal"` |
| `grid` | Grid dimensions | `c(cols, rows)` or `c(rings)` |
| `size` | Physical size (mm) | `c(width, height)` or `c(diameter)` |
| `seed` | Random seed | Any integer |
| `offset` | Piece separation | `0` (touching) to `20+` (separated) |
| `fusion` | Merge pieces | PILES notation string |

### Type-Specific Parameters

**Hexagonal:**

- `do_warp`: Apply circular warping (default: `TRUE`)
- `do_trunc`: Truncate to boundary (default: `TRUE`)

**Concentric:**

- `center_shape`: `"hexagon"` or `"circle"`
- `ring_spacing`: Space between rings

**Voronoi:**

- `n_cells`: Number of pieces
- `relaxation`: Lloyd relaxation iterations

**Random:**

- `n_pieces`: Number of pieces
- `n_corner`: Corners per piece (3-8)

## Separation Modes

Control how pieces are positioned:

```{r}
#| label: separation-modes
#| fig-align: center
p1 <- ggplot() +
  geom_puzzle_rect(
    aes(fill = after_stat(piece_id)),
    cols = 3, rows = 2,
    offset = 0,
    seed = 42
  ) +
  scale_fill_viridis_c(guide = "none") +
  coord_fixed() +
  theme_puzzle() +
  labs(title = "offset = 0")

p2 <- ggplot() +
  geom_puzzle_rect(
    aes(fill = after_stat(piece_id)),
    cols = 3, rows = 2,
    offset = 10,
    seed = 42
  ) +
  scale_fill_viridis_c(guide = "none") +
  coord_fixed() +
  theme_puzzle() +
  labs(title = "offset = 10")

p3 <- ggplot() +
  geom_puzzle_rect(
    aes(fill = after_stat(piece_id)),
    cols = 3, rows = 2,
    offset = 20,
    seed = 42
  ) +
  scale_fill_viridis_c(guide = "none") +
  coord_fixed() +
  theme_puzzle() +
  labs(title = "offset = 20")

p1 + p2 + p3
```

## Next Steps

- [**Gallery**](gallery/rectangular.qmd): Explore all puzzle types with visual examples
- [**API Reference**](api/generate-puzzle.qmd): Complete function documentation
- [**PILES Notation**](api/piles-notation.qmd): Learn to merge pieces
- [**Tutorials**](tutorials/basic-usage.qmd): Step-by-step guides
